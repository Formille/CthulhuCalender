<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ê¸°ì¥ - 365 ì–´ë“œë²¤ì²˜: í¬íˆ´ë£¨</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js"></script>
    <style>
        .diary-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .month-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .month-tab {
            padding: 10px 20px;
            background: rgba(139, 69, 19, 0.3);
            border: 1px solid #8b4513;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .month-tab:hover,
        .month-tab.active {
            background: #8b4513;
            color: #fff;
        }
        .diary-entries {
            display: grid;
            gap: 20px;
        }
        .diary-entry {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #444;
        }
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }
        .entry-date {
            font-size: 1.2em;
            color: #d4af37;
            font-weight: bold;
        }
        .tag.madness {
            background: rgba(139, 0, 0, 0.5);
            color: #ff0000;
        }
        .entry-content {
            line-height: 1.8;
            color: #e0e0e0;
        }
        .entry-content h1,
        .entry-content h2,
        .entry-content h3 {
            color: #d4af37;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }
        .entry-content p {
            margin-bottom: 1em;
        }
        .entry-content strong {
            color: #fff;
            font-weight: bold;
        }
        .entry-content em {
            font-style: italic;
            color: #d4af37;
        }
        .entry-content code {
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        .entry-content pre {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .entry-content blockquote {
            border-left: 3px solid #d4af37;
            padding-left: 15px;
            margin-left: 0;
            color: #ccc;
            font-style: italic;
        }
        .chapter-summary {
            background: rgba(212, 175, 55, 0.1);
            border-left: 4px solid #d4af37;
            padding: 15px;
            margin-bottom: 20px;
            font-style: italic;
        }
        .month-conclusion-section {
            margin-bottom: 20px;
        }
        .conclusion-button {
            padding: 12px 24px;
            background: rgba(212, 175, 55, 0.3);
            border: 2px solid #d4af37;
            border-radius: 5px;
            color: #d4af37;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .conclusion-button:hover {
            background: #d4af37;
            color: #000;
        }
        .conclusion-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .conclusion-result {
            background: rgba(212, 175, 55, 0.1);
            border-left: 4px solid #d4af37;
            padding: 20px;
            margin-top: 20px;
            line-height: 1.8;
            color: #e0e0e0;
        }
        .conclusion-result h3 {
            color: #d4af37;
            margin-top: 0;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ì¡´ ë°€ëŸ¬ì˜ ì¼ê¸°ì¥</h1>
            <p class="subtitle"><!-- ê³„ì‚° ê°’ ë“¤ì–´ê°--></p>
            <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav class="main-nav">
                <a href="/" class="nav-link">í™ˆ</a>
                <a href="/play" class="nav-link">ê¸°ë¡í•˜ê¸°</a>
                <a href="/diary" class="nav-link active">ì¼ê¸°ì¥</a>
                <a href="/report" class="nav-link">ë³´ê³ ì„œ</a>
            </nav>
        </header>

        <div class="diary-container">
            <!-- ì›”ë³„ íƒ­ -->
            <div class="month-tabs" id="month-tabs">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>

            <!-- ì±•í„° ìš”ì•½ -->
            <div id="chapter-summary" class="chapter-summary" style="display: none;"></div>

            <!-- ì›”ë³„ ê²°ì‚° ë²„íŠ¼ -->
            <div id="month-conclusion-section" class="month-conclusion-section" style="display: none;">
                <button id="conclusion-button" class="conclusion-button">ì›”ì˜ ì´ì•¼ê¸° ê²°ì‚°</button>
                <div id="conclusion-result" class="conclusion-result" style="display: none;"></div>
            </div>

            <!-- ì¼ê¸° ëª©ë¡ -->
            <div class="diary-entries" id="diary-entries">
                <div class="loading">ë¡œë”© ì¤‘...</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '';
        let currentMonth = null;
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                        'July', 'August', 'September', 'October', 'November', 'December'];
        const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”',
                           '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];

        // ì‘ì€ í¬ê¸°ì˜ í¬íˆ´ë£¨ ì•„ì´ì½˜ ë¡œë“œ í•¨ìˆ˜ (íƒœê·¸ìš©)
        async function loadCthulhuIconSmall(container) {
            try {
                const response = await fetch(`${API_BASE}/static/images/cthulhu.svg`);
                const svgText = await response.text();
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgText, 'image/svg+xml');
                const svgElement = svgDoc.querySelector('svg');
                if (svgElement) {
                    svgElement.setAttribute('width', '20');
                    svgElement.setAttribute('height', '20');
                    svgElement.setAttribute('style', 'display: inline-block; vertical-align: middle;');
                    const path = svgElement.querySelector('path');
                    if (path) {
                        path.setAttribute('fill', 'currentColor');
                        path.setAttribute('stroke', 'currentColor');
                    }
                    container.innerHTML = '';
                    container.appendChild(svgElement);
                }
            } catch (error) {
                console.error('í¬íˆ´ë£¨ ì•„ì´ì½˜ ë¡œë“œ ì‹¤íŒ¨:', error);
                container.textContent = 'ğŸ™';
            }
        }

        // ì‘ì€ í¬ê¸°ì˜ ì¡°ìš° ìœ í˜• ì•„ì´ì½˜ ë¡œë“œ í•¨ìˆ˜ (íƒœê·¸ìš©)
        async function loadActionIconSmall(container, symbol) {
            try {
                let iconPath = '';
                if (symbol === 'COMBAT') {
                    iconPath = `${API_BASE}/static/images/pistol.svg`;
                } else if (symbol === 'INVESTIGATION') {
                    iconPath = `${API_BASE}/static/images/search.svg`;
                } else if (symbol === 'SEARCH') {
                    iconPath = `${API_BASE}/static/images/flashlight.svg`;
                } else {
                    return;
                }
                
                const response = await fetch(iconPath);
                const svgText = await response.text();
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgText, 'image/svg+xml');
                const svgElement = svgDoc.querySelector('svg');
                if (svgElement) {
                    svgElement.setAttribute('width', '20');
                    svgElement.setAttribute('height', '20');
                    svgElement.setAttribute('style', 'display: inline-block; vertical-align: middle;');
                    const path = svgElement.querySelector('path');
                    const circle = svgElement.querySelector('circle');
                    const line = svgElement.querySelector('line');
                    if (path) {
                        path.setAttribute('fill', 'currentColor');
                        path.setAttribute('stroke', 'currentColor');
                    }
                    if (circle) {
                        circle.setAttribute('stroke', 'currentColor');
                    }
                    if (line) {
                        line.setAttribute('stroke', 'currentColor');
                    }
                    container.innerHTML = '';
                    container.appendChild(svgElement);
                }
            } catch (error) {
                console.error('ì•„ì´ì½˜ ë¡œë“œ ì‹¤íŒ¨:', error);
                // í´ë°± ì´ëª¨ì§€
                const emojiMap = {
                    'COMBAT': 'ğŸ”«',
                    'INVESTIGATION': 'ğŸ”',
                    'SEARCH': 'ğŸ”¦'
                };
                container.textContent = emojiMap[symbol] || 'â“';
            }
        }

        // ë§ˆí¬ë‹¤ìš´ì„ HTMLë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function renderMarkdown(markdownText) {
            if (!markdownText) return '';
            try {
                // ì´ìŠ¤ì¼€ì´í”„ëœ ë”°ì˜´í‘œë¥¼ ì¼ë°˜ ë”°ì˜´í‘œë¡œ ë³€í™˜ (JSONì—ì„œ ì˜¨ ê²½ìš°)
                let processedText = markdownText.replace(/\\"/g, '"');
                
                // ë”°ì˜´í‘œê°€ í¬í•¨ëœ ë§ˆí¬ë‹¤ìš´ íŒ¨í„´ì„ ë¨¼ì € ì²˜ë¦¬
                // *"í…ìŠ¤íŠ¸"* íŒ¨í„´ì„ *í…ìŠ¤íŠ¸*ë¡œ ë³€í™˜ (ë”°ì˜´í‘œ ì œê±°)
                processedText = processedText.replace(/\*"([^"]+)"\*/g, '*$1*');
                
                // marked.jsë¥¼ ì‚¬ìš©í•˜ì—¬ ë§ˆí¬ë‹¤ìš´ì„ HTMLë¡œ ë³€í™˜
                if (typeof marked !== 'undefined') {
                    // marked.js ì˜µì…˜ ì„¤ì • (breaks: trueë¡œ ì¤„ë°”ê¿ˆ ì²˜ë¦¬)
                    const markedOptions = {
                        breaks: true,
                        gfm: true
                    };
                    let html = marked.parse(processedText, markedOptions);
                    return html;
                } else {
                    // marked.jsê°€ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° ê¸°ë³¸ ë³€í™˜
                    return processedText
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*([^*\n]+?)\*/g, '<em>$1</em>')
                        .replace(/\n/g, '<br>');
                }
            } catch (error) {
                console.error('ë§ˆí¬ë‹¤ìš´ ë³€í™˜ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ ë³€í™˜ ì‹œë„
                let fallbackText = markdownText.replace(/\\"/g, '"');
                return fallbackText
                    .replace(/\*"([^"]+)"\*/g, '<em>$1</em>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*([^*\n]+?)\*/g, '<em>$1</em>')
                    .replace(/\n/g, '<br>');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            await loadCampaignYear();
            await loadAllChapters();
        });

        // ìº í˜ì¸ ì—°ë„ ë¡œë“œ
        async function loadCampaignYear() {
            const response = await fetch(`${API_BASE}/api/game/state`);
            const data = await response.json();

            if (data.success) {
                const subtitle = document.querySelector('.subtitle');
                if (subtitle) {
                    const campaignYear = data.campaign_year || 1926;
                    subtitle.textContent = `${campaignYear}ë…„ì˜ ê¸°ë¡`;
                }
            }
        }

        // ëª¨ë“  ì±•í„° ë¡œë“œ
        async function loadAllChapters() {
            try {
                const response = await fetch(`${API_BASE}/api/narrative/all-chapters`);
                const data = await response.json();
                
                if (data.success) {
                    const monthTabs = document.getElementById('month-tabs');
                    monthTabs.innerHTML = '';
                    
                    if (data.chapters.length === 0) {
                        document.getElementById('diary-entries').innerHTML = 
                            '<div class="error">ì•„ì§ ì‘ì„±ëœ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                        return;
                    }
                    
                    // í”„ë¡¤ë¡œê·¸ì™€ ì¼ë°˜ ì±•í„° ë¶„ë¦¬
                    const prologueChapter = data.chapters.find(c => c.is_prologue);
                    const regularChapters = data.chapters.filter(c => !c.is_prologue);
                    
                    // ì¼ë°˜ ì±•í„°ë¥¼ ì—­ìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ì›”ì´ ì•ì— ì˜¤ë„ë¡)
                    const sortedChapters = [...regularChapters].reverse();
                    
                    // ì²« ë²ˆì§¸ ì›”ì„ ê¸°ë³¸ìœ¼ë¡œ ì„ íƒ (ìµœì‹ ì›” ë˜ëŠ” í”„ë¡¤ë¡œê·¸)
                    if (sortedChapters.length > 0) {
                        currentMonth = sortedChapters[0].month;
                    } else if (prologueChapter) {
                        currentMonth = 'Prologue';
                    }
                    
                    // ì¼ë°˜ ì±•í„° íƒ­ ì¶”ê°€ (ìµœì‹ ì›”ë¶€í„°)
                    sortedChapters.forEach(chapter => {
                        const tab = document.createElement('div');
                        tab.className = 'month-tab';
                        tab.textContent = getMonthName(chapter.month);
                        tab.dataset.month = chapter.month;
                        
                        if (chapter.month === currentMonth) {
                            tab.classList.add('active');
                        }
                        
                        tab.addEventListener('click', () => loadMonth(chapter.month));
                        monthTabs.appendChild(tab);
                    });
                    
                    // í”„ë¡¤ë¡œê·¸ íƒ­ ì¶”ê°€ (ë§¨ ì˜¤ë¥¸ìª½)
                    if (prologueChapter) {
                        const tab = document.createElement('div');
                        tab.className = 'month-tab';
                        tab.textContent = 'í”„ë¡¤ë¡œê·¸';
                        tab.dataset.month = 'Prologue';
                        
                        if (currentMonth === 'Prologue') {
                            tab.classList.add('active');
                        }
                        
                        tab.addEventListener('click', () => loadPrologue());
                        monthTabs.appendChild(tab);
                    }
                    
                    // ê°€ì¥ ìµœì‹  ì›”ì˜ ì¼ê¸°ë¥¼ ë¨¼ì € í‘œì‹œ
                    if (sortedChapters.length > 0) {
                        await loadMonth(currentMonth);
                    } else if (prologueChapter) {
                        // ì›”ì´ ì—†ê³  í”„ë¡¤ë¡œê·¸ë§Œ ìˆëŠ” ê²½ìš°ì—ë§Œ í”„ë¡¤ë¡œê·¸ í‘œì‹œ
                        currentMonth = 'Prologue';
                        await loadPrologue();
                    }
                }
            } catch (error) {
                console.error('ì±•í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('diary-entries').innerHTML = 
                    '<div class="error">ì¼ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ì›”ë³„ ì¼ê¸° ë¡œë“œ
        async function loadMonth(month) {
            currentMonth = month;
            
            // íƒ­ í™œì„±í™”
            document.querySelectorAll('.month-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.month === month);
            });
            
            // ê²°ì‚° ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.getElementById('month-conclusion-section').style.display = 'none';
            document.getElementById('conclusion-result').style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/api/narrative/month/${month}`);
                const data = await response.json();
                
                if (data.success) {
                    // ì±•í„° ìš”ì•½ ìˆ¨ê¸°ê¸° (ê²°ì‚°ì´ ìˆìœ¼ë©´ ì¼ê¸° ì—”íŠ¸ë¦¬ë¡œ í‘œì‹œ)
                    const summaryDiv = document.getElementById('chapter-summary');
                    summaryDiv.style.display = 'none';
                    
                    // ì™„ë£Œ ìƒíƒœ í™•ì¸
                    let isCompleted = false;
                    try {
                        const completionResponse = await fetch(`${API_BASE}/api/narrative/month/${month}/completion-status`);
                        const completionData = await completionResponse.json();
                        isCompleted = completionData.success && completionData.is_completed;
                        
                        if (isCompleted) {
                            // ì™„ë£Œëœ ê²½ìš° ê²°ì‚° ë²„íŠ¼ í‘œì‹œ (ê²°ì‚°ì´ ì—†ì„ ë•Œë§Œ)
                            if (!data.chapter_summary) {
                                const conclusionSection = document.getElementById('month-conclusion-section');
                                const conclusionButton = document.getElementById('conclusion-button');
                                conclusionButton.textContent = `${getMonthName(month)}ì˜ ì´ì•¼ê¸° ê²°ì‚°`;
                                conclusionButton.dataset.month = month;
                                conclusionSection.style.display = 'block';
                            }
                        }
                    } catch (error) {
                        console.error('ì™„ë£Œ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                    }
                    
                    // ì¼ê¸° ëª©ë¡ í‘œì‹œ
                    const entriesDiv = document.getElementById('diary-entries');
                    entriesDiv.innerHTML = '';
                    
                    // ê²°ì‚°ì´ ìˆìœ¼ë©´ ì¼ê¸° ì—”íŠ¸ë¦¬ ìŠ¤íƒ€ì¼ë¡œ í‘œì‹œ
                    if (data.chapter_summary) {
                        const conclusionEntry = document.createElement('div');
                        conclusionEntry.className = 'diary-entry';
                        
                        const header = document.createElement('div');
                        header.className = 'entry-header';
                        
                        const dateSpan = document.createElement('div');
                        dateSpan.className = 'entry-date';
                        dateSpan.textContent = `${getMonthName(month)}ì˜ ì´ì•¼ê¸° ê²°ì‚°`;
                        header.appendChild(dateSpan);
                        
                        const tagsDiv = document.createElement('div');
                        tagsDiv.className = 'entry-tags';
                        const conclusionTag = document.createElement('span');
                        conclusionTag.className = 'tag';
                        conclusionTag.textContent = 'ê²°ì‚°';
                        tagsDiv.appendChild(conclusionTag);
                        header.appendChild(tagsDiv);
                        
                        const content = document.createElement('div');
                        content.className = 'entry-content';
                        content.innerHTML = renderMarkdown(data.chapter_summary);
                        
                        conclusionEntry.appendChild(header);
                        conclusionEntry.appendChild(content);
                        entriesDiv.appendChild(conclusionEntry);
                    }
                    
                    if (data.entries.length === 0) {
                        if (!data.chapter_summary) {
                            entriesDiv.innerHTML = '<div class="error">ì´ ë‹¬ì—ëŠ” ì‘ì„±ëœ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                        }
                        return;
                    }
                    
                    // ì¼ê¸°ë¥¼ ë‚ ì§œ ê¸°ì¤€ ì—­ìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  ì¼ê¸°ê°€ ìœ„ì— ì˜¤ë„ë¡)
                    const sortedEntries = [...data.entries].sort((a, b) => {
                        const dateA = new Date(a.diary_write_date);
                        const dateB = new Date(b.diary_write_date);
                        return dateB - dateA; // ìµœì‹  ë‚ ì§œê°€ ì•ì— ì˜¤ë„ë¡
                    });
                    
                    sortedEntries.forEach(entry => {
                        const entryDiv = document.createElement('div');
                        entryDiv.className = 'diary-entry';
                        
                        const header = document.createElement('div');
                        header.className = 'entry-header';
                        
                        const dateSpan = document.createElement('div');
                        dateSpan.className = 'entry-date';
                        dateSpan.textContent = `${entry.diary_write_date} (${entry.day_of_week})`;
                        
                        const tagsDiv = document.createElement('div');
                        tagsDiv.className = 'entry-tags';
                        
                        // ì„±ê³µ/ì‹¤íŒ¨ íƒœê·¸
                        const successTag = document.createElement('span');
                        successTag.className = `tag ${entry.is_success ? 'success' : 'failure'}`;
                        successTag.textContent = entry.is_success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
                        tagsDiv.appendChild(successTag);
                        
                        // ì¡°ìš° ìœ í˜• ì•„ì´ì½˜ íƒœê·¸
                        if (entry.action_type) {
                            const actionTag = document.createElement('span');
                            actionTag.className = 'tag';
                            const actionIconContainer = document.createElement('span');
                            actionIconContainer.className = 'tag-icon';
                            loadActionIconSmall(actionIconContainer, entry.action_type);
                            actionTag.appendChild(actionIconContainer);
                            tagsDiv.appendChild(actionTag);
                        }
                        
                        // ì£¼ì‚¬ìœ„ ìˆ˜ íƒœê·¸
                        if (entry.dice_sum !== undefined && entry.dice_sum > 0) {
                            const diceTag = document.createElement('span');
                            diceTag.className = 'tag';
                            diceTag.textContent = `${entry.dice_sum}`;
                            tagsDiv.appendChild(diceTag);
                        }
                        
                        // ê´‘ê¸° ìˆ˜ë§Œí¼ í¬íˆ´ë£¨ ì•„ì´ì½˜ í‘œì‹œ
                        if (entry.cthulhu_symbol_count && entry.cthulhu_symbol_count > 0) {
                            for (let i = 0; i < entry.cthulhu_symbol_count; i++) {
                                const cthulhuTag = document.createElement('span');
                                cthulhuTag.className = 'tag cthulhu-tag';
                                const cthulhuIconContainer = document.createElement('span');
                                cthulhuIconContainer.className = 'cthulhu-icon-small';
                                loadCthulhuIconSmall(cthulhuIconContainer);
                                cthulhuTag.appendChild(cthulhuIconContainer);
                                tagsDiv.appendChild(cthulhuTag);
                            }
                        }
                        
                        header.appendChild(dateSpan);
                        header.appendChild(tagsDiv);
                        
                        const content = document.createElement('div');
                        content.className = 'entry-content';
                        // ì „ì²´ í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ì „ì²´ í…ìŠ¤íŠ¸ í‘œì‹œ, ì—†ìœ¼ë©´ ìš”ì•½ í‘œì‹œ
                        const markdownText = entry.full_text || entry.summary || '(ë‚´ìš© ì—†ìŒ)';
                        content.innerHTML = renderMarkdown(markdownText);
                        
                        entryDiv.appendChild(header);
                        entryDiv.appendChild(content);
                        
                        entriesDiv.appendChild(entryDiv);
                    });
                }
            } catch (error) {
                console.error('ì›”ë³„ ì¼ê¸° ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('diary-entries').innerHTML = 
                    '<div class="error">ì¼ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        // í”„ë¡¤ë¡œê·¸ ë¡œë“œ
        async function loadPrologue() {
            currentMonth = 'Prologue';
            
            // íƒ­ í™œì„±í™”
            document.querySelectorAll('.month-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.month === 'Prologue');
            });
            
            try {
                const response = await fetch(`${API_BASE}/api/narrative/prologue`);
                const data = await response.json();
                
                if (data.success) {
                    // ì±•í„° ìš”ì•½ ìˆ¨ê¸°ê¸°
                    document.getElementById('chapter-summary').style.display = 'none';
                    
                    // ì¼ê¸° ëª©ë¡ í‘œì‹œ
                    const entriesDiv = document.getElementById('diary-entries');
                    entriesDiv.innerHTML = '';
                    
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'diary-entry';
                    
                    const header = document.createElement('div');
                    header.className = 'entry-header';
                    
                    const dateSpan = document.createElement('div');
                    dateSpan.className = 'entry-date';
                    dateSpan.textContent = `í”„ë¡¤ë¡œê·¸ - ${data.prologue.date}`;
                    
                    header.appendChild(dateSpan);
                    
                    const content = document.createElement('div');
                    content.className = 'entry-content';
                    content.innerHTML = renderMarkdown(data.prologue.content);
                    
                    entryDiv.appendChild(header);
                    entryDiv.appendChild(content);
                    
                    entriesDiv.appendChild(entryDiv);
                }
            } catch (error) {
                console.error('í”„ë¡¤ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('diary-entries').innerHTML = 
                    '<div class="error">í”„ë¡¤ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        function getMonthName(month) {
            const index = months.indexOf(month);
            return index !== -1 ? monthNames[index] : month;
        }

        // ê²°ì‚° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', () => {
            const conclusionButton = document.getElementById('conclusion-button');
            if (conclusionButton) {
                conclusionButton.addEventListener('click', async function() {
                    const month = this.dataset.month;
                    if (!month) return;
                    
                    // ë²„íŠ¼ ë¹„í™œì„±í™”
                    this.disabled = true;
                    this.textContent = 'ê²°ì‚° ìƒì„± ì¤‘...';
                    
                    try {
                        const response = await fetch(`${API_BASE}/api/game/month-conclusion`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ month: month })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            // ê²°ì‚° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                            document.getElementById('month-conclusion-section').style.display = 'none';
                            
                            // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ê²°ì‚° ê²°ê³¼ë¥¼ ì¼ê¸° ì—”íŠ¸ë¦¬ë¡œ í‘œì‹œ
                            await loadMonth(month);
                        } else {
                            alert('ê²°ì‚° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                            this.disabled = false;
                            this.textContent = `${getMonthName(month)}ì˜ ì´ì•¼ê¸° ê²°ì‚°`;
                        }
                    } catch (error) {
                        console.error('ê²°ì‚° ìƒì„± ì‹¤íŒ¨:', error);
                        alert('ê²°ì‚° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        this.disabled = false;
                        this.textContent = `${getMonthName(month)}ì˜ ì´ì•¼ê¸° ê²°ì‚°`;
                    }
                });
            }
        });
    </script>
</body>
</html>

